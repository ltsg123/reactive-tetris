# RxJS æ¸¸æˆä¹‹ä¿„ç½—æ–¯æ–¹å—

---

> è´ªåƒè›‡é“¾æ¥ï¼šhttps://github.com/RxJS-CN/rxjs-articles-translation/blob/master/articles/TAMING-SNAKES-WITH-REACTIVE-STREAMS.md

å—ç½‘ä¸Š RxJS è´ªåƒè›‡çš„å¯å‘ï¼Œå°è¯•å†™ä¸€ä¸ªç»ƒæ‰‹ï¼Œæ°é€¢å¥³å‹å–œæ¬¢ä¿„ç½—æ–¯æ–¹å—ï¼Œå› è€Œæœ‰äº†è¿™ç¯‡æ–‡ç« ã€‚

## ç›®å½•

---

- [æ¸¸æˆæ¦‚è§ˆ](#æ¸¸æˆæ¦‚è§ˆ)

- [è®¾ç½®æ¸¸æˆåŒºåŸŸ](#è®¾ç½®æ¸¸æˆåŒºåŸŸ)

## æ¸¸æˆæ¦‚è§ˆ

---

æˆ‘å°†é‡æ–°æ‰“é€ ä¸€æ¬¾ä¿„ç½—æ–¯æ–¹å—æ¸¸æˆï¼Œè¿˜æ˜¯ç”± 7 ç§å›¾å½¢ï¼ˆ"O","I","S","Z","L","J","T"ï¼‰ç»„æˆï¼Œä¸åŒçš„æ˜¯ï¼Œè¿™æ¬¡æ‰€æœ‰å›¾å½¢éƒ½æœ‰ä¸¤ç§é…è‰²ï¼ˆæ³¨ï¼šä¸å­˜åœ¨ä¸€ä¸ªå›¾å½¢æœ‰ä¸¤ä¸ªé¢œè‰²ï¼‰ï¼Œè¿™æ ·è®¾è®¡çš„åˆè¡·åªæ˜¯ä¸ºäº†æ–°å¢ä¸€ä¸ªå½©è›‹æ•ˆåº” --- å¦‚æœå®ç°å•å±‚åŒè‰²ï¼Œå¯å®ç°å…¨å±æ¸…é™¤ã€‚

### å…·ä½“æ­¥éª¤ï¼š

å°†åŒºåŸŸä¸Šé¢å‡ºç°çš„å›¾å½¢åˆç†åœ°å¹³é“ºåˆ°å®¹å™¨åº•éƒ¨ï¼Œå½“å‡ºç°ä¸€è¡Œå®Œå…¨é“ºæ»¡ï¼Œåˆ™ä¼šæ¶ˆå»è¯¥è¡Œï¼›å¦‚æœé“ºæ»¡ä¸”åŒè‰²ï¼Œåˆ™ä¼šæ¶ˆå»æ‰€æœ‰å›¾å½¢ï¼›è®°åˆ†æ–¹å¼é€šè¿‡æ¶ˆå»çš„æ ¼å­è®¡ç®—ï¼›

## è®¾ç½®æ¸¸æˆåŒºåŸŸ

---

åœ¨å¼€å§‹æ¸¸æˆå‰ï¼Œé¦–å…ˆè¦åˆ›å»º

## ç¡®å®šæºå¤´æµ

---

å¤§è‡´ç½—åˆ—æ¸¸æˆæ‰€éœ€è¦çš„åŠŸèƒ½ï¼š

- ç”Ÿæˆéšæœºæ–¹å—
- ç”¨æŒ‰é”®æ§åˆ¶æ–¹å—å·¦å³ç§»åŠ¨å’Œå¿«é€Ÿä¸‹è½
- æŒ‰é”®ç©ºæ ¼/ç‚¹å‡»æ§åˆ¶æ—‹è½¬
- è®°å½•æ–¹å—(åŒ…æ‹¬ç¢°æ’å’Œæ¶ˆé™¤)

## æ–¹å—ç”Ÿæˆ

---

æ–¹å—çš„ç»„æˆï¼Œé™¤äº†å¤–éƒ¨å½¢å¼ 4 ä¸ªå¯è§åƒç´ ç‚¹ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå…³é”®çš„éšè—ç‚¹ï¼ˆä¸­å¿ƒç‚¹ï¼‰â€”â€” æ–¹å—æ—‹è½¬å˜åŒ–æ—¶ä½œå‚ç…§

æ–¹å—ä¸€èˆ¬ 7 ç§æƒ…å†µï¼ˆ"O","I","S","Z","L","J","T"ï¼‰ï¼Œæœ‰å›ºå®šçš„ç‚¹é›†ï¼š

```typescript

```

## æ–¹å—æ“ä½œ

---

æ–¹å—æœ‰å››ä¸ªæ“ä½œï¼šç§»åŠ¨ï¼ˆå·¦å³ï¼‰ã€å¿«é€Ÿä¸‹è½ã€å‘ä¸Šæ—‹è½¬ï¼ˆé¡ºæ—¶é’ˆä¸”ä¿è¯æ—‹è½¬ä¸€å‘¨å›åˆ°åŸåœ°ï¼‰;

### ç§»åŠ¨

éœ€æ±‚æ˜¯æ–¹å—ä¸‹è½è¿‡ç¨‹ä¸­å¯ä»¥è°ƒæ•´å·¦å³çš„ä½ç½®ï¼Œä½¿å…¶å¯ä»¥ä¸‹è½åœ¨åˆé€‚çš„ä½ç½®ï¼›("â¬…ï¸"ï¼Œâ€œâ¡ï¸â€ï¼Œâ€œAâ€ , "D")

```typescript
// ç§»åŠ¨å‚æ•°
export const MOVE_DIRECTIONS = {
  37: { x: -1, y: 0 },
  39: { x: 1, y: 0 },
  A: { x: -1, y: 0 },
  D: { x: 1, y: 0 },
};

// main
let move$ = keydown$.pipe(
  map((event: KeyboardEvent) => MOVE_DIRECTIONS[event.keyCode]),
  filter((direction) => !!direction)
);
```

### å¿«é€Ÿä¸‹è½

æ–¹å—é»˜è®¤é€Ÿåº¦æ˜¯å•æ–¹æ ¼ç§»åŠ¨ï¼Œå¦‚æœæƒ³è¦åŠ å¿«æ¸¸æˆçš„è¿›å±•ï¼Œè‡ªç„¶éœ€è¦æé€Ÿ ğŸ˜œ

```typescript

```

- å¿«é€Ÿä¸‹è½
- å‘ä¸Šæ—‹è½¬

## åº•éƒ¨è¾¹ç•Œ

---

ä¿„ç½—æ–¯æ–¹å—åº•éƒ¨è‡ªç„¶æ˜¯è¦è®¾ç½®è¾¹ç•Œçš„ï¼Œä¸ç„¶ä¹Ÿç©ä¸ä¸‹å» ğŸ¤£ï¼Œä¸çŸ¥é“ä»¥å‰çš„ç‰ˆæœ¬å¦‚ä½•ï¼Œæˆ‘æ‰“ç®—å·¦å³ä¸ç•™è¾¹ç•Œï¼Œå¯ä»¥æ­£å¸¸è·¨ç•Œã€‚

**è¾¹ç•Œçš„ä½œç”¨ï¼š**é˜²æ­¢ä¿„ç½—æ–¯æ–¹å—è„±ç¦»å®¹å™¨ï¼Œæ–¹å—è§¦ç¢°åˆ°è¾¹ç•Œå°±ä¼šå¤±å»æ´»æ€§ï¼ˆå³ä¸èƒ½ç§»åŠ¨ï¼‰ï¼Œåˆ©ç”¨æŸç§ç®—æ³•ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„è¾¹ç•Œã€‚

æ¥ä¸‹æ¥å¥è¦åˆ†æè¾¹ç•Œçš„å˜åŒ–ï¼š

åˆå§‹çš„æ—¶å€™ï¼Œä»¥å®¹å™¨çš„åº•éƒ¨ä¸ºè¾¹ç•Œï¼Œåˆ©ç”¨å…¨å±€å¸¸é‡åˆ—é•¿æ¥ç”Ÿæˆä¸€ä¸ªä¸ªç‚¹ï¼Œç»„æˆè¾¹ç•Œçš„é›†åˆï¼š

```typescript
// canvas
export const COLS = 200;

// constant
export const INITIAL_SCENE_BOTTOM_BORDER = [...new Array(COLS).keys()].map(
  (x) =>
    Object.assign(
      {},
      {
        x: x,
        y: 0,
      }
    )
);
```

è¿‡ç¨‹ä¸­ï¼Œå½“æ–¹å—è§¦ç¢°åˆ°è¾¹ç•Œæ—¶ï¼Œé¦–å…ˆè®©æ–¹å—å¤±å»æ´»æ€§ï¼Œæˆä¸ºè¾¹ç•Œï¼ŒåŒæ—¶è½®è¯¢æ–¹å—æ‰€è®¾è®¡çš„æ¯ä¸€è¡Œï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ¶ˆå»ï¼ˆå³ç”¨æˆ·å¾—åˆ†ï¼‰ï¼Œæœ€åå†ç”Ÿæˆä¸€ä¸ªæ–°çš„è¾¹ç•Œã€‚

å¾—åˆ†ç®—æ³•ï¼ˆæ¶ˆå»æ–¹æ ¼ï¼‰ï¼š

```typescript
// æ›´æ–°å®¹å™¨åº•éƒ¨è¾¹ç•Œ
// utils
export function updateBorder(merge: Array<Point2D>, border: Array<Point2D>) {
  let mergeBorder = [...merge, ...border];
  const heights = Array.from(new Set(merge.map((point: Point2D) => point.y)));
  heights.forEach((height) => {
    const length = mergeBorder.filter(
      (point: Point2D) => point.y === height
    ).length;
    if (length === COLS) {
      mergeBorder = mergeBorder.filter((point: Point2D) => point.y !== height);
    }
  });

  return mergeBorder;
}

// main
let border$ = new BehaviorSubject<Array<Point2D>>(INITIAL_SCENE_BOTTOM_BORDER);

let sceneBottomBorder$ = border$.pipe(scan(updateBorder));

let score$ = sceneBottomBorder$.pipe(
  map((points) => points.length),
  scan((acc, curr) => acc + curr, 0)
);
```

ç»“æŸæ—¶ï¼Œå½“è¾¹ç•Œçš„æœ€é«˜ç‚¹ä½äºå®¹å™¨çš„ä¸Šå±‚è¾¹ç•Œï¼ˆå³ y<0ï¼‰ï¼Œæç¤º GAME OVERï¼›

## æ–¹å—ç§»åŠ¨

---

æ–¹å—çš„ç§»åŠ¨é€‰æ‹©
